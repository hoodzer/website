<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Zugang</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    input[type="password"] {
      padding: 10px;
      font-size: 1em;
      margin-top: 10px;
      background: #111;
      color: #fff;
      border: 1px solid #333;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      background: #444;
      color: white;
      border: none;
      cursor: pointer;
    }
    .error {
      color: red;
      margin-top: 15px;
    }
    .counter {
      margin-top: 30px;
      font-size: 0.9em;
      color: #888;
    }
  </style>
</head>
<body>
  <h2>Wer bist du?</h2>
  <p>Warst du brav oder ...?</p>
  <input type="password" id="pw" placeholder="Passwort">
  <button onclick="check()">Absenden</button>
  <div class="error" id="err"></div>
  <div class="counter">Besucher insgesamt: <span id="counter">...</span></div>

  <script>
    const counterURL = "https://api.counterapi.dev/v2/geheimprojekt123/geheimprojekt123";
    const apiKey = "ut_ySsVqHqRzwaUZe1k1aJ33KTEjxPPoqUaTtcc3oJL";

    // Zähler hochzählen und Wert anzeigen
    fetch(`${counterURL}/up`, {
      headers: {
        "Authorization": `Bearer ${apiKey}`
      }
    })
    .then(r => r.json())
    .then(() => {
      // danach aktuellen Wert abfragen
      return fetch(counterURL, {
        headers: {
          "Authorization": `Bearer ${apiKey}`
        }
      });
    })
    .then(r => r.json())
    .then(data => {
      const value = data?.data?.value ?? "unbekannt";
      document.getElementById("counter").textContent = value;
    })
    .catch(() => {
      document.getElementById("counter").textContent = "unbekannt";
    });

    // Passwortprüfung
    async function check() {
      const input = document.getElementById('pw').value;
      const hash = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(input));
      const hex = Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');

      const valid = "5bea8750614d3661fd6d8ecf7f15ea3461b2f53f2c0cdfe5fc2f0d3c0812956a";

      if (hex === valid) {
        window.location.href = "https://linkly.link/2CfL2";
      } else {
        document.getElementById("err").textContent = "Zugang verweigert.";
      }
    }
  </script>
</body>
</html>
